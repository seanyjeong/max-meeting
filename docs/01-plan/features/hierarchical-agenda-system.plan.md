# 계층형 안건 시스템 개선 계획

> 작성일: 2026-01-30
> 상태: Plan

## 1. 개요

### 1.1 배경
현재 MAX Meeting은 계층형 안건(대안건-자식안건)을 DB에 저장하지만, UI에서는 대안건만 표시되고 자식안건은 제대로 활용되지 않음. 질문 생성도 대안건에만 적용되어 자식안건별 세부 논의가 불가능.

### 1.2 목표
- 자식안건의 완전한 UI 지원 (표시, 탐색, 타임스탬프)
- 안건 계층별 질문 생성 및 관리
- 계층형 회의록 생성 (PDF)
- PWA 업데이트 알림 제거

## 2. 기능 요구사항

### 2.1 회의 상세 페이지
| 현재 | 개선 |
|------|------|
| 대안건만 표시 | 대안건 + 자식안건 토글 표시 |
| 질문은 대안건에만 | 자식안건에 질문 (없으면 대안건) |
| 펼침/접힘 없음 | 토글로 자식안건 펼치기/접히기 |

### 2.2 녹음 페이지
| 현재 | 개선 |
|------|------|
| 대안건만 목록에 | 대안건 + 자식안건 계층 표시 |
| 다음 버튼 = 대안건 이동 | 다음 버튼 = 대안건 이동 (유지) |
| 자식안건 클릭 불가 | 자식안건 클릭 → 해당 타임스탬프 |
| time_segments 대안건만 | time_segments 자식안건도 지원 |

### 2.3 결과 페이지 대화 내용
| 현재 | 개선 |
|------|------|
| 대안건별 탭 필터링 | 대안건 → 자식안건 계층 필터링 |
| 플랫 구조 | 계층형 구조 (대안건 > 자식안건) |

### 2.4 PDF 회의록 (신규)
- 안건별 내용 정리 (대안건 > 자식안건)
- 안건별 메모 (notes) 표시
- 안건별 필기 (sketches) 보기 버튼
- 전문적인 레이아웃

### 2.5 PWA 업데이트 알림 제거
- "새 버전이 있습니다" 팝업 비활성화

## 3. 영향 범위

### 3.1 수정 필요 파일

**Frontend:**
```
src/routes/meetings/[id]/+page.svelte          # 회의 상세
src/routes/meetings/[id]/record/+page.svelte   # 녹음 페이지
src/routes/meetings/[id]/results/+page.svelte  # 결과 페이지
src/lib/components/recording/AgendaNotePanel.svelte  # 녹음 안건 패널
src/lib/components/results/TranscriptViewer.svelte   # 대화 내용 뷰어
src/lib/utils/exportPdf.ts                     # PDF 내보내기
src/service-worker.ts (또는 관련 PWA 파일)     # 업데이트 알림
```

**Backend:**
```
app/services/llm.py (또는 관련)                # 질문 생성 로직
workers/tasks/llm.py                           # LLM 태스크
```

### 3.2 신규 파일
```
src/routes/meetings/[id]/results/report/+page.svelte  # PDF 회의록 페이지
src/lib/components/results/MeetingReport.svelte       # 회의록 컴포넌트
```

## 4. 비기능 요구사항

- **호환성**: 기존 회의 데이터와 하위 호환
- **성능**: 대용량 안건 목록에서도 부드러운 토글
- **터치 최적화**: 11인치 태블릿 가로 모드 기준 48px+ 터치 타겟
- **오프라인**: PWA 업데이트 제거해도 오프라인 기능 유지

## 5. 구현 우선순위

```
Phase 1: PWA 업데이트 알림 제거 (빠른 수정)
Phase 2: 회의 상세 - 자식안건 토글 표시
Phase 3: 녹음 페이지 - 자식안건 클릭/타임스탬프
Phase 4: 결과 페이지 - 계층형 대화 내용
Phase 5: 질문 생성 - 자식안건 우선 로직
Phase 6: PDF 회의록 페이지
```

## 6. 리스크 및 고려사항

| 리스크 | 대응 |
|--------|------|
| 기존 회의 데이터 호환 | 자식안건 없으면 기존처럼 동작 |
| 깊은 계층 (3단계+) | 현재 2단계(대안건-자식안건)만 지원 |
| 성능 (많은 자식안건) | 가상 스크롤 또는 페이지네이션 검토 |

## 7. 검증 방법

1. 기존 회의에서 자식안건 정상 표시 확인
2. 녹음 중 자식안건 클릭 → 타임스탬프 저장 확인
3. 결과 페이지 계층 필터링 동작 확인
4. PDF 내보내기 → 안건별 정리 확인
5. PWA 업데이트 알림 미노출 확인

---

## 다음 단계

`/pdca design hierarchical-agenda-system` 으로 상세 설계 진행
