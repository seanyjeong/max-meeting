#!/bin/bash
# MAX Meeting í†µí•© ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸
# ì‚¬ìš©: maxmeeting [start|stop|restart|status|logs]

SERVICES="maxmeeting-api maxmeeting-worker maxmeeting-beat"

case "$1" in
    start)
        echo "ğŸš€ Starting MAX Meeting services..."
        for svc in $SERVICES; do
            sudo systemctl start $svc
            echo "  âœ“ $svc started"
        done
        ;;
    stop)
        echo "ğŸ›‘ Stopping MAX Meeting services..."
        for svc in $SERVICES; do
            sudo systemctl stop $svc
            echo "  âœ“ $svc stopped"
        done
        ;;
    restart)
        echo "ğŸ”„ Restarting MAX Meeting services..."
        for svc in $SERVICES; do
            sudo systemctl restart $svc
            echo "  âœ“ $svc restarted"
        done
        ;;
    status)
        echo "ğŸ“Š MAX Meeting Status"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        for svc in $SERVICES; do
            status=$(systemctl is-active $svc)
            if [ "$status" = "active" ]; then
                echo "  âœ… $svc: $status"
            else
                echo "  âŒ $svc: $status"
            fi
        done
        ;;
    logs)
        # ì‹¤ì‹œê°„ í†µí•© ë¡œê·¸
        shift
        if [ "$1" = "api" ]; then
            sudo journalctl -u maxmeeting-api -f
        elif [ "$1" = "worker" ]; then
            sudo journalctl -u maxmeeting-worker -f
        elif [ "$1" = "beat" ]; then
            sudo journalctl -u maxmeeting-beat -f
        else
            # ëª¨ë“  ì„œë¹„ìŠ¤ ë¡œê·¸ í†µí•©
            sudo journalctl -u maxmeeting-api -u maxmeeting-worker -u maxmeeting-beat -f
        fi
        ;;
    deploy)
        echo "ğŸš€ Deploying MAX Meeting..."
        cd /home/et/max-ops/max-meeting
        git pull origin main
        echo "  âœ“ Git pull complete"
        for svc in $SERVICES; do
            sudo systemctl restart $svc
        done
        echo "  âœ“ All services restarted"
        echo "âœ… Deploy complete!"
        ;;
    *)
        echo "MAX Meeting ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸"
        echo ""
        echo "Usage: maxmeeting <command>"
        echo ""
        echo "Commands:"
        echo "  start    - ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘"
        echo "  stop     - ëª¨ë“  ì„œë¹„ìŠ¤ ì¤‘ì§€"
        echo "  restart  - ëª¨ë“  ì„œë¹„ìŠ¤ ì¬ì‹œì‘"
        echo "  status   - ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸"
        echo "  logs     - í†µí•© ë¡œê·¸ ë³´ê¸° (ì‹¤ì‹œê°„)"
        echo "  logs api     - API ë¡œê·¸ë§Œ"
        echo "  logs worker  - Worker ë¡œê·¸ë§Œ"
        echo "  logs beat    - Beat ë¡œê·¸ë§Œ"
        echo "  deploy   - Git pull + ì¬ì‹œì‘"
        ;;
esac
