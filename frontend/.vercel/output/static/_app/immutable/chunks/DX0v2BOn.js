import{b as u,P as f}from"./VgTo3XoD.js";import{E as g}from"./dEE0t6TH.js";const m=f,l="max-meeting-cache",b=1,o={meetings:"meetings",agendas:"agendas",contacts:"contacts"};let i=null;async function d(){return i||new Promise((e,s)=>{const a=indexedDB.open(l,b);a.onerror=()=>s(a.error),a.onsuccess=()=>{i=a.result,e(i)},a.onupgradeneeded=n=>{const t=n.target.result;t.objectStoreNames.contains(o.meetings)||t.createObjectStore(o.meetings,{keyPath:"id"}),t.objectStoreNames.contains(o.agendas)||t.createObjectStore(o.agendas,{keyPath:"id"}).createIndex("meeting_id","meeting_id",{unique:!1}),t.objectStoreNames.contains(o.contacts)||t.createObjectStore(o.contacts,{keyPath:"id"})}})}async function S(e,s){const n=(await d()).transaction(e,"readwrite"),t=n.objectStore(e);for(const r of s)t.put(r);return new Promise((r,c)=>{n.oncomplete=()=>{r()},n.onerror=()=>c(n.error)})}async function p(e){const n=(await d()).transaction(o.meetings,"readonly").objectStore(o.meetings);return new Promise((t,r)=>{const c=n.get(e);c.onsuccess=()=>{c.result,t(c.result||null)},c.onerror=()=>r(c.error)})}async function y(){try{const e=g(u),s={"Content-Type":"application/json"};e.accessToken&&(s.Authorization=`Bearer ${e.accessToken}`);const a=await fetch(`${m}/contacts?limit=100`,{headers:s});if(a.ok){const t=(await a.json()).data||[];await S(o.contacts,t)}}catch{}}function P(){return!navigator.onLine}export{y as c,p as g,P as i};
